<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Doggyco 3.3 - Smooth Edition</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
:root { 
    --retro-yellow: #ffd166;
    --retro-pink: #ff9ecf; 
    --retro-blue: #4facfe; 
    --retro-green: #06d6a0; 
    --retro-red: #ef476f; 
}

* { margin:0; padding:0; box-sizing:border-box; touch-action:manipulation; }

body{
    font-family:'Segoe UI',sans-serif;
    background:#0a0a0f;
    color:white;
    display:flex;
    flex-direction:column;
    align-items:center;
    height:100vh;
    width:100vw;
    overflow:hidden;
    padding:10px;
}

.retro-title{
    font-family:'Press Start 2P';
    color:var(--retro-yellow);
    font-size:1.2rem;
    margin-bottom:10px;
}

#gameWrapper{
    position:relative;
    width:100%;
    max-width:420px;
    flex:1;
    background:#87CEEB;
    border-radius:25px;
    border:5px solid #fff;
    overflow:hidden;
}

canvas{ width:100%; height:100%; display:block; }

#topBar{
    position:absolute;
    top:0; left:0;
    width:100%; height:45px;
    background:rgba(0,0,0,0.4);
    z-index:10;
}
#innerBar{
    height:100%;
    width:0%;
    transition:width 0.3s linear;
    background:var(--retro-green);
}

#uiPanel{
    position:absolute;
    top:12px; left:12px; right:12px;
    display:flex;
    justify-content:space-between;
    font-family:'Press Start 2P';
    font-size:0.6rem;
    z-index:20;
    pointer-events:none;
}

#controlArea{
    width:100%;
    max-width:420px;
    background:#222;
    padding:20px;
    border-radius:20px;
    border:2px solid #444;
    margin-top:15px;
}

#slider{
    width:100%;
    height:30px;
    appearance:none;
    background:#333;
    border-radius:15px;
    outline:none;
}
#slider::-webkit-slider-thumb{
    appearance:none;
    width:60px; height:60px;
    border-radius:50%;
    background:var(--retro-pink);
    border:4px solid white;
}

.overlay{
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.9);
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    z-index:100;
}

button{
    padding:20px 40px;
    font-family:'Press Start 2P';
    font-size:1rem;
    background:var(--retro-green);
    border:none;
    border-radius:15px;
    color:white;
    cursor:pointer;
}
</style>
</head>

<body>

<h1 class="retro-title">DOGGYCO 3.3</h1>

<div id="gameWrapper">
    <div id="topBar"><div id="innerBar"></div></div>
    <div id="uiPanel">
        <div>‚≠ê <span id="score">0</span></div>
        <div id="heartContainer">‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è</div>
        <div>LVL <span id="lvlDisplay">1</span></div>
    </div>
    <canvas id="game"></canvas>
    <div class="overlay" id="startScreen">
        <button onclick="startGame()">START</button>
    </div>
    <div class="overlay" id="gameOver" style="display:none;">
        <h2 style="color:var(--retro-red);margin-bottom:20px;font-family:'Press Start 2P'">GAME OVER</h2>
        <button onclick="location.reload()">RETRY</button>
    </div>
</div>

<div id="controlArea">
    <input type="range" id="slider" min="0" max="1000" value="500">
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const slider = document.getElementById("slider");
const innerBar = document.getElementById("innerBar");

let state="start";
let score=0;
let lives=3;
let currentLevel=1;
let timeLeft=30;

let items=[];
let itemsSpawned=0;
let itemsCaught=0;

let spawnTimer=0;
let baseSpawnRate=1.2;

let dog={x:200,vx:0,tail:0};

function syncResolution(){
    const dpr=window.devicePixelRatio||1;
    const rect=canvas.getBoundingClientRect();
    canvas.width=rect.width*dpr;
    canvas.height=rect.height*dpr;
    ctx.scale(dpr,dpr);
}
window.addEventListener("resize",syncResolution);

function startGame(){
    state="play";
    document.getElementById("startScreen").style.display="none";
    syncResolution();
    loop();
}

function loop(){
if(state!=="play")return;

const W=canvas.width/(window.devicePixelRatio||1);
const H=canvas.height/(window.devicePixelRatio||1);

ctx.clearRect(0,0,W,H);

let grad=ctx.createLinearGradient(0,0,0,H);
grad.addColorStop(0,"#4facfe");
grad.addColorStop(1,"#87CEEB");
ctx.fillStyle=grad;
ctx.fillRect(0,0,W,H);

const groundY=H-75;
ctx.fillStyle="#6cc24a";
ctx.fillRect(0,groundY,W,75);

ctx.fillStyle="#333";
ctx.fillRect(0,H-45,W,45);

const targetX=(slider.value/1000)*(W-80)+40;
let ax=(targetX-dog.x)*0.12;
dog.vx+=ax;
dog.vx*=0.85;
dog.x+=dog.vx;

spawnTimer+=1/60;
let levelSpawnRate=Math.max(0.5,baseSpawnRate-(currentLevel*0.08));

if(spawnTimer>=levelSpawnRate){
    spawnTimer=0;

    let r=Math.random();
    let it={
        xPct:Math.random()*0.8+0.1,
        y:-50,
        speed:3+(currentLevel*0.6)
    };

    if(r<0.1){it.type="üëÆ";it.danger=true;}
    else if(r<0.3){it.type="üçó";it.val=3;}
    else if(r<0.6){it.type="üç™";it.val=2;}
    else{it.type="ü¶¥";it.val=1;}

    if(!items.some(e=>Math.abs(e.xPct-it.xPct)<0.1)){
        items.push(it);
        if(!it.danger)itemsSpawned++;
    }
}

items.forEach((it,i)=>{
    it.y+=it.speed;
    let ix=it.xPct*W;
    ctx.font=it.danger?"55px Arial":"40px Arial";
    ctx.fillText(it.type,ix-20,it.y);

    if(it.y>groundY-45&&it.y<groundY+20&&Math.abs(ix-dog.x)<40){
        if(it.danger){
            lives--;
            updateHearts();
            if(lives<=0)endGame();
        }else{
            score+=it.val;
            itemsCaught++;
            dog.tail=15;
        }
        items.splice(i,1);
    }
});

ctx.save();
ctx.translate(dog.x,groundY+25);
if(dog.tail>0){
    ctx.rotate(Math.sin(Date.now()*0.1)*0.15);
    dog.tail--;
}
ctx.font="80px Arial";
ctx.fillText("üê∂",-40,0);
ctx.restore();

let pct=itemsSpawned>0?(itemsCaught/itemsSpawned)*100:0;
innerBar.style.width=Math.min(pct,100)+"%";
innerBar.style.background=pct>=50?"var(--retro-green)":"var(--retro-red)";

timeLeft-=1/60;
document.getElementById("score").innerText=score;

if(timeLeft<=0){
    if(pct>=50){
        currentLevel++;
        document.getElementById("lvlDisplay").innerText=currentLevel;
    }else{
        lives--;
        updateHearts();
        if(lives<=0)endGame();
    }
    itemsSpawned=0;
    itemsCaught=0;
    timeLeft=30;
}

requestAnimationFrame(loop);
}

function updateHearts(){
let h="";
for(let i=0;i<3;i++)h+=i<lives?"‚ù§Ô∏è ":"üñ§ ";
document.getElementById("heartContainer").innerHTML=h;
}

function endGame(){
state="over";
document.getElementById("gameOver").style.display="flex";
}
</script>

</body>
</html>
