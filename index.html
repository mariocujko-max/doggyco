<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Doggyco: Forest Ranger Pro</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
    :root { --neon-green: #00ff88; --forest-dark: #051a02; --ui-glass: rgba(0, 30, 10, 0.8); }
    * { margin:0; padding:0; box-sizing:border-box; touch-action:none; }
    body { overflow:hidden; font-family:'Orbitron', sans-serif; background:#000; color: white; }

    #wrap {
        position:relative; height:100vh; max-width:500px; margin:auto; overflow:hidden;
        background: linear-gradient(to bottom, #0a2e05 0%, #051a02 100%);
        border: 2px solid #222;
    }

    /* HUD */
    #hud {
        position: absolute; top: 15px; width: 100%; display: flex; 
        justify-content: space-around; align-items: center; z-index: 60;
    }
    .hud-box {
        background: var(--ui-glass); border: 1px solid var(--neon-green);
        padding: 5px 12px; border-radius: 8px; backdrop-filter: blur(10px);
        text-align: center; min-width: 85px; box-shadow: 0 0 15px rgba(0,255,136,0.1);
    }
    #hearts-ui { font-size: 20px; color: #ff3131; }
    .label { font-size: 9px; color: var(--neon-green); text-transform: uppercase; }
    .val { font-size: 16px; font-weight: 900; }

    #energy-wrap {
        position: absolute; top: 80px; left: 15%; width: 70%; height: 10px; 
        background: rgba(0,0,0,0.6); border: 1px solid white; border-radius: 10px; overflow: hidden; z-index: 60;
    }
    #energy-bar { height: 100%; width: 100%; background: var(--neon-green); transition: width 0.1s linear; }

    canvas { width: 100%; height: 100%; display: block; }

    /* Overlays & Animationen */
    .overlay {
        position:absolute; inset:0; background:rgba(0,10,2,0.95); display:flex; flex-direction:column;
        justify-content:center; align-items:center; z-index:100; text-align: center; padding: 25px;
        animation: fadeIn 0.8s ease-out;
    }
    @keyframes fadeIn { from { opacity: 0; transform: scale(1.1); } to { opacity: 1; transform: scale(1); } }

    .panel {
        background: var(--ui-glass); border: 2px solid var(--neon-green);
        padding: 20px; border-radius: 15px; width: 100%; margin-bottom: 20px;
    }

    .btn-play {
        padding: 15px 45px; font-size: 20px; background: transparent; color: var(--neon-green);
        border: 2px solid var(--neon-green); border-radius: 50px; cursor: pointer; font-family: 'Orbitron';
        font-weight: 900; letter-spacing: 2px; transition: 0.3s;
    }
    .btn-play:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 30px var(--neon-green); }

    .leaderboard { width: 100%; font-size: 12px; margin-top: 15px; }
    .lb-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(0,255,136,0.2); }

    .instruction { font-size: 11px; line-height: 1.5; color: #aaa; margin: 15px 0; }
</style>
</head>
<body>

<div id="wrap">
    <div id="hud">
        <div class="hud-box" id="hearts-ui">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
        <div class="hud-box">
            <span class="label">Punkte</span>
            <span class="val" id="score-val">0</span>
        </div>
        <div class="hud-box">
            <span class="label">Rang</span>
            <span class="val">#<span id="rank-val">--</span></span>
        </div>
    </div>

    <div id="energy-wrap"><div id="energy-bar"></div></div>

    <canvas id="game"></canvas>

    <div class="overlay" id="start-screen">
        <h1 style="color:var(--neon-green); font-size: 32px; letter-spacing: 4px; margin-bottom: 5px;">DOGGYCO</h1>
        <p style="font-size: 10px; margin-bottom: 20px;">FOREST RANGER MISSION</p>
        
        <div class="panel">
            <p class="instruction">
                <b>ANLEITUNG:</b> Steuere den Ranger mit Wischen oder den Pfeiltasten. Sammle Knochen f√ºr Energie. 
                Sammle Herzen f√ºr Extraleben (max 3). Meide Spinnen & Polizei!<br>
                <i>Achtung: Sinkt die Energie unter 20%, verlierst du ein Leben.</i>
            </p>
            <div class="leaderboard" id="leaderboard-ui">
                </div>
        </div>
        
        <button class="btn-play" onclick="initGame()">Start Engine</button>
    </div>

    <div class="overlay" style="display:none;" id="game-over">
        <h2 style="color:#ff3131;">MISSION FAILED</h2>
        <div style="font-size: 40px; margin: 20px 0;" id="final-score">0</div>
        <button class="btn-play" onclick="location.reload()">Reboot</button>
    </div>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W, H, lanes = 5, laneW;
let dogLane = 2, dogX = 0, targetX = 0;
let items = [], spiders = [], clouds = [], fireflies = [], floatingTexts = [];
let score = 0, hearts = 3, energy = 100, level = 1, active = false;
let lastTime = 0, heartSpawned = false;

// Audio
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSFX(f, t, d, v=0.06) {
    if(audioCtx.state === 'suspended') audioCtx.resume();
    let o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type=t; o.frequency.setValueAtTime(f, audioCtx.currentTime);
    g.gain.setValueAtTime(v, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime+d);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime+d);
}

function resize() {
    W = canvas.width = canvas.parentElement.offsetWidth;
    H = canvas.height = canvas.parentElement.offsetHeight;
    laneW = W / lanes;
}
window.onresize = resize; resize();

// Rangliste laden
function loadLB() {
    let scores = JSON.parse(localStorage.getItem('doggyHighscores') || '[]');
    let html = '<div class="label" style="margin-bottom:5px;">Top Rangers</div>';
    scores.slice(0, 3).forEach((s, i) => {
        html += `<div class="lb-row"><span>#${i+1} Ranger</span><span>${s}</span></div>`;
    });
    document.getElementById('leaderboard-ui').innerHTML = html;
}
loadLB();

function saveScore(s) {
    let scores = JSON.parse(localStorage.getItem('doggyHighscores') || '[]');
    scores.push(s); scores.sort((a,b) => b-a);
    localStorage.setItem('doggyHighscores', JSON.stringify(scores.slice(0, 5)));
}

// Controls
const handleInput = (e) => {
    if(!active) return;
    let x = (e.touches ? e.touches[0].clientX : e.clientX) - canvas.getBoundingClientRect().left;
    dogLane = Math.floor(x / laneW);
    dogLane = Math.max(0, Math.min(lanes-1, dogLane));
}
canvas.onmousemove = handleInput;
canvas.ontouchmove = (e) => { e.preventDefault(); handleInput(e); };
window.addEventListener('keydown', (e) => {
    if(e.key === 'ArrowLeft') dogLane = Math.max(0, dogLane - 1);
    if(e.key === 'ArrowRight') dogLane = Math.min(lanes - 1, dogLane + 1);
});

function initGame() {
    document.getElementById("start-screen").style.display = "none";
    active = true;
    lastTime = performance.now();
    // Fireflies & Scenery
    for(let i=0; i<15; i++) fireflies.push({x: Math.random()*W, y: Math.random()*H, s: 0.2+Math.random()*0.5, r: 1+Math.random()*2});
    
    // Ambient Music Synth
    setInterval(() => { if(active) playSFX(100 + (level*10), 'sine', 1, 0.03); }, 900);
    requestAnimationFrame(loop);
}

function loop(t) {
    if(!active) return;
    let delta = (t - lastTime) / 1000;
    lastTime = t;
    ctx.clearRect(0,0,W,H);

    // Hintergrund & Gl√ºhw√ºrmchen
    fireflies.forEach(f => {
        f.y -= f.s; if(f.y < -10) f.y = H+10;
        ctx.fillStyle = "rgba(0, 255, 136, 0.5)";
        ctx.beginPath(); ctx.arc(f.x, f.y, f.r, 0, Math.PI*2); ctx.fill();
    });

    // Energie-Logik
    energy -= (1.5 + level*0.5) * delta;
    document.getElementById("energy-bar").style.width = energy + "%";
    if(energy < 20) { hearts--; energy = 70; playSFX(120, 'sawtooth', 0.5); }
    if(energy <= 0) energy = 0;

    // Items Spawning (Nicht zu viele auf einmal)
    if(Math.random() < 0.015 + level*0.005){
        let type = "ü¶¥";
        let r = Math.random();
        if(r < 0.08) type = "üëÆ";
        else if(r < 0.15) type = "üçñ";
        else if(r < 0.18 && !heartSpawned) { type = "‚ù§Ô∏è"; heartSpawned = true; }
        items.push({lane: Math.floor(Math.random()*lanes), y: -60, type});
    }

    for(let i=items.length-1; i>=0; i--){
        let it = items[i];
        it.y += (180 + level*40) * delta;
        let ix = it.lane*laneW + laneW/2;
        ctx.font="40px Arial"; ctx.textAlign="center";
        ctx.fillText(it.type, ix, it.y);

        if(it.lane===dogLane && it.y > H-150 && it.y < H-80){
            if(it.type === "üëÆ") { hearts--; playSFX(100, 'sawtooth', 0.4); }
            else if(it.type === "‚ù§Ô∏è") { 
                if(hearts < 3) hearts++; 
                score += 50 * level; playSFX(800, 'sine', 0.3);
            } else {
                let p = it.type === "üçñ" ? 30 : 10;
                score += p; energy = Math.min(100, energy + 12);
                playSFX(400+p*5, 'sine', 0.1);
                floatingTexts.push({x:ix, y:it.y, v:"+"+p, l:1});
            }
            items.splice(i,1);
        } else if(it.y > H) items.splice(i,1);
    }

    // Spinnen (Bedrohlich & Reparatur Mobile-H√∂he)
    if(spiders.length < 2) spiders.push({x: Math.random()*W, t: 0, s: 0.02, targetX: Math.random()*W});
    spiders.forEach(s => {
        s.t += s.s; let sy = (Math.sin(s.t)+1)/2 * (H-150);
        ctx.strokeStyle = "rgba(0, 255, 136, 0.3)";
        ctx.beginPath(); ctx.moveTo(s.x,0); ctx.lineTo(s.x,sy); ctx.stroke();
        ctx.font="35px Arial"; ctx.fillText("üï∑Ô∏è", s.x, sy+25);
        if(Math.abs(s.x - dogX) < 40 && sy > H-180 && sy < H-70) energy -= 0.6;
    });

    // Dog Physics
    targetX = dogLane*laneW+laneW/2;
    dogX += (targetX - dogX) * 0.22;
    ctx.font="60px Arial"; ctx.fillText("üê∂", dogX, H-80);

    // UI Updates
    document.getElementById("score-val").innerText = score;
    document.getElementById("hearts-ui").innerText = "‚ù§Ô∏è".repeat(Math.max(0, hearts));

    if(score > level * 250) { level++; heartSpawned = false; playSFX(900, 'square', 0.2); }
    if(hearts <= 0) { 
        active = false; saveScore(score); 
        document.getElementById("game-over").style.display = "flex";
        document.getElementById("final-score").innerText = score;
    } else {
        requestAnimationFrame(loop);
    }
}
</script>
</body>
</html>

