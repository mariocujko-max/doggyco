<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Doggyco 3.2 - Professional Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root { 
            --retro-yellow: #ffd166; --retro-pink: #ff9ecf; 
            --retro-blue: #4facfe; --retro-green: #06d6a0; --retro-red: #ef476f; 
        }
        * { margin: 0; padding: 0; box-sizing: border-box; touch-action: manipulation; }
        
        body {
            font-family: 'Segoe UI', sans-serif; background: #1a1a2e; color: white;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 10px;
            overflow: hidden;
        }

        .retro-title { font-family: 'Press Start 2P'; font-size: 1.5rem; color: var(--retro-yellow); margin-bottom: 15px; text-shadow: 3px 3px #000; }

        /* Edler Fortschrittsbalken */
        #progressContainer {
            width: 100%; max-width: 400px; background: rgba(0,0,0,0.5); height: 40px; 
            border-radius: 20px; border: 3px solid #fff; position: relative; overflow: hidden; margin-bottom: 10px;
            box-shadow: 0 0 15px rgba(255,255,255,0.2);
        }
        #progressBar { 
            width: 0%; height: 100%; background: linear-gradient(90deg, var(--retro-red), #ff4d4d); 
            transition: width 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: 0 0 20px var(--retro-red);
        }
        #progressText { position: absolute; width: 100%; text-align: center; top: 10px; font-family: 'Press Start 2P'; font-size: 0.65rem; color: white; text-shadow: 1px 1px 2px #000; z-index: 2; }

        #gameWrapper {
            position: relative; width: 400px; height: 700px; background: #87CEEB; 
            border-radius: 25px; border: 5px solid white; overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.6);
        }

        #uiPanel {
            position: absolute; top: 15px; left: 15px; right: 15px;
            background: rgba(255,255,255,0.95); color: #333; padding: 10px;
            border-radius: 12px; display: flex; justify-content: space-between; font-weight: bold; z-index: 10;
            font-family: 'Press Start 2P'; font-size: 0.6rem;
        }

        #controlBar { position: absolute; bottom: 0; width: 100%; height: 80px; background: #111; display: flex; justify-content: center; align-items: center; }
        #slider { width: 85%; height: 40px; accent-color: var(--retro-pink); cursor: pointer; }

        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; text-align: center;
        }

        button {
            padding: 18px 35px; font-family: 'Press Start 2P'; font-size: 0.9rem;
            background: linear-gradient(var(--retro-green), #05a87d); border: none; border-radius: 15px; cursor: pointer; color: white;
            box-shadow: 0 5px 0 #047a5b; transition: 0.1s;
        }
        button:active { transform: translateY(3px); box-shadow: 0 2px 0 #047a5b; }

        @media (max-width: 450px) {
            #gameWrapper { width: 95vw; height: 70vh; }
            #progressContainer { width: 95vw; }
        }
    </style>
</head>
<body>

    <h1 class="retro-title">DOGGYCO</h1>

    <div id="progressContainer">
        <div id="progressBar"></div>
        <div id="progressText">LEVEL 1: 0%</div>
    </div>

    <div id="gameWrapper">
        <div id="uiPanel">
            <div>‚≠ê <span id="score">0</span></div>
            <div id="heartContainer">‚ù§Ô∏è ‚ù§Ô∏è ‚ù§Ô∏è</div>
            <div>‚è± <span id="time">30</span></div>
        </div>
        <canvas id="game"></canvas>
        <div id="controlBar"><input type="range" id="slider" min="40" max="360"></div>

        <div class="overlay" id="startScreen">
            <h2 style="font-family:'Press Start 2P'; color:var(--retro-yellow); margin-bottom:20px;">BEREIT?</h2>
            <p style="margin-bottom: 30px; font-size: 0.7rem; line-height: 1.6; padding: 0 20px;">Fange Leckerlis! Ziel: 80% Quote.<br>Vorsicht vor den Spinnen!</p>
            <button onclick="startGame()">WUFF!</button>
        </div>
        
        <div class="overlay" id="gameOver" style="display:none;">
            <h2 id="failMessage" style="font-family:'Press Start 2P'; color:var(--retro-red); margin-bottom: 20px;"></h2>
            <button onclick="location.reload()">NOCHMAL</button>
        </div>
    </div>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const slider = document.getElementById("slider");
    const progressBar = document.getElementById("progressBar");
    const progressText = document.getElementById("progressText");

    let state = "start", score = 0, lives = 3, timeLeft = 30, items = [], dog = {x:200, hit: 0};
    let currentLevel = 1, itemsSpawned = 0, itemsCaught = 0, audioCtx;
    let clouds = [{x: 20, y: 50, s: 0.4}, {x: 250, y: 130, s: 0.6}];
    let spiders = [
        {x: 80, t: 0, speed: 0.02}, 
        {x: 320, t: Math.PI, speed: 0.025}
    ];

    function resize() {
        canvas.width = document.getElementById("gameWrapper").clientWidth;
        canvas.height = document.getElementById("gameWrapper").clientHeight - 80;
    }
    window.addEventListener("resize", resize); resize();

    function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function playSfx(f, t, d) {
        if (!audioCtx) return;
        let o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.type = t; o.frequency.value = f; g.gain.value = 0.1;
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
        o.stop(audioCtx.currentTime + d);
    }

    function startGame() {
        initAudio(); score = 0; lives = 3; currentLevel = 1; resetLevelStats();
        state = "play"; document.getElementById("startScreen").style.display = "none"; loop();
    }

    function resetLevelStats() {
        timeLeft = 30; items = []; itemsSpawned = 0; itemsCaught = 0;
    }

    function loop() {
        if (state !== "play") return;
        ctx.clearRect(0,0,canvas.width, canvas.height);

        // 1. Hintergrund
        ctx.fillStyle = "#87CEEB"; ctx.fillRect(0,0,canvas.width, canvas.height);
        clouds.forEach(c => {
            c.x += c.s; if(c.x > canvas.width + 60) c.x = -70;
            ctx.font = "50px Arial"; ctx.fillText("‚òÅÔ∏è", c.x, c.y);
        });

        // 2. Boden
        ctx.fillStyle = "#6cc24a"; ctx.fillRect(0, canvas.height-60, canvas.width, 60);
        ctx.fillStyle = "#555"; ctx.fillRect(0, canvas.height-40, canvas.width, 40);

        // 3. Spinnen Logic (Gleiten ganz nach unten)
        spiders.forEach(s => {
            s.t += s.speed;
            let range = canvas.height - 150;
            let spiderY = 50 + (Math.sin(s.t) + 1) / 2 * range;
            
            ctx.strokeStyle = "rgba(255,255,255,0.6)"; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(s.x, 0); ctx.lineTo(s.x, spiderY); ctx.stroke();
            ctx.font = "40px Arial"; ctx.fillText("üï∑Ô∏è", s.x - 20, spiderY + 15);
            
            if (Math.abs(s.x - dog.x) < 35 && Math.abs(spiderY - (canvas.height-90)) < 45) {
                let penalty = Math.ceil(itemsSpawned * 0.2);
                itemsCaught = Math.max(0, itemsCaught - penalty);
                dog.hit = 20; playSfx(100, 'sawtooth', 0.4);
                s.t += Math.PI * 0.5; // Sto√üe die Spinne weg
            }
        });

        // 4. Items Spawning (In festen Spuren gegen √úberschneidung)
        if (Math.random() < 0.04) {
            let lanes = [50, 120, 200, 280, 350];
            let laneX = lanes[Math.floor(Math.random() * lanes.length)];
            
            // Pr√ºfen ob in der Lane schon ein Item sehr weit oben ist
            let tooClose = items.some(it => it.x === laneX && it.y < 100);
            
            if (!tooClose) {
                let r = Math.random();
                let type = "ü¶¥", val = 1, danger = false;
                if (r < 0.1) { type = "üëÆ"; danger = true; }
                else if (r < 0.3) { type = "üçó"; val = 3; }
                else if (r < 0.6) { type = "üç™"; val = 2; }
                
                items.push({ x: laneX, y: -50, type, val, danger, speed: 2.5 + (currentLevel * 0.6) });
                if (!danger) itemsSpawned++;
            }
        }

        // 5. Items bewegen
        items.forEach((it, i) => {
            it.y += it.speed;
            ctx.font = "42px Arial"; ctx.fillText(it.type, it.x - 21, it.y);

            if (it.y > canvas.height - 115 && it.y < canvas.height - 40 && Math.abs(it.x - dog.x) < 35) {
                if (it.danger) { 
                    lives--; dog.hit = 30; playSfx(80, 'square', 0.5); updateHeartUI(); 
                } else { 
                    itemsCaught++; score += it.val; playSfx(600, 'sine', 0.1); 
                }
                items.splice(i, 1);
            } else if (it.y > canvas.height) { items.splice(i, 1); }
        });

        // 6. Hund
        dog.x = parseInt(slider.value);
        let bounce = Math.sin(Date.now()/160) * 4;
        ctx.save();
        if(dog.hit > 0) { 
            ctx.filter = "sepia(1) saturate(20) hue-rotate(-50deg)"; 
            dog.hit--; 
        }
        ctx.font = "65px Arial"; 
        ctx.fillText("üê∂", dog.x - 32, canvas.height - 85 + bounce);
        ctx.restore();

        // 7. Progress Update
        let pct = itemsSpawned > 0 ? Math.round((itemsCaught / itemsSpawned) * 100) : 0;
        progressBar.style.width = Math.min(pct, 100) + "%";
        progressBar.style.background = pct < 80 ? "var(--retro-red)" : "var(--retro-green)";
        progressText.innerText = `LEVEL ${currentLevel}: ${pct}%`;

        timeLeft -= 1/60;
        document.getElementById("score").innerText = score;
        document.getElementById("time").innerText = Math.max(0, Math.ceil(timeLeft));

        if (lives <= 0) return endGame("HUNDEM√úDE?");
        
        if (timeLeft <= 0) {
            if (pct >= 80) { 
                currentLevel++; resetLevelStats(); playSfx(800, 'sine', 0.6); 
                alert("LEVEL UP! Jetzt wird's schneller!"); 
            } else { 
                lives--; updateHeartUI(); 
                if(lives > 0) { 
                    alert("SITZ! Zu wenig Leckerlis gesammelt."); 
                    resetLevelStats(); 
                } else {
                    endGame("AB INS K√ñRBCHEN!");
                }
            }
        }
        requestAnimationFrame(loop);
    }

    function updateHeartUI() {
        let h = "";
        for(let i=0; i<3; i++) h += i < lives ? "‚ù§Ô∏è " : "üñ§ ";
        document.getElementById("heartContainer").innerHTML = h;
    }

    function endGame(msg) {
        state = "over";
        document.getElementById("failMessage").innerText = msg;
        document.getElementById("gameOver").style.display = "flex";
    }

</script>
</body>
</html>
