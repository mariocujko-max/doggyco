<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Doggyco 3.0</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
overflow:hidden;
font-family:Segoe UI,sans-serif;
background:linear-gradient(#89cff0,#cdefff);
display:flex;
flex-direction:column;
align-items:center;
touch-action:none;
}

#gameWrapper{
position:relative;
width:400px;
height:650px;
overflow:hidden;
border-radius:15px;
box-shadow:0 10px 30px rgba(0,0,0,0.3);
background:linear-gradient(#89cff0,#cdefff);
}

canvas{display:block;}

#controlBar{
position:absolute;
bottom:0;
width:100%;
height:70px;
background:#222;
}

#slider{
position:absolute;
bottom:20px;
left:50%;
transform:translateX(-50%);
width:80%;
}

.overlay{
position:absolute;
top:0;
left:0;
width:100%;
height:100%;
background:rgba(0,0,0,0.85);
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
color:white;
text-align:center;
padding:20px;
}

button{
padding:10px 20px;
border:none;
border-radius:20px;
background:linear-gradient(45deg,#ff9ecf,#ffd166);
font-weight:bold;
margin-top:10px;
cursor:pointer;
}
</style>
</head>
<body>

<div id="gameWrapper">

<canvas id="game" width="400" height="650"></canvas>

<div id="controlBar">
<input type="range" id="slider" min="0" max="360">
</div>

<div class="overlay" id="startScreen">
<h2>Doggyco 3.0</h2>
<p>ü¶¥=1 | üç™=2 | üçó=3<br>
30 Sekunden pro Level<br>
Mindestens 80% sammeln!</p>
<input id="playerName" placeholder="Dein Name">
<button onclick="startGame()">Start</button>
</div>

<div class="overlay" id="gameOver" style="display:none;">
<h2>Game Over</h2>
<p id="finalScore"></p>
<button onclick="restart()">Nochmal spielen</button>
</div>

</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const slider=document.getElementById("slider");

let state="start";
let score,lives,level,speed,timeLeft;
let items,totalPoints,collectedPoints;
let dog,clouds;

function init(){
score=0;
lives=3;
level=1;
speed=2;
timeLeft=30;
items=[];
totalPoints=0;
collectedPoints=0;
dog={x:180,y:520};
clouds=[{x:50,y:80},{x:200,y:120},{x:320,y:60}];
}

slider.addEventListener("input",e=>{
dog.x=parseInt(e.target.value);
});

function startGame(){
if(!playerName.value.trim()) return alert("Name eingeben üê∂");
init();
state="play";
document.getElementById("startScreen").style.display="none";
loop();
}

function restart(){
document.getElementById("gameOver").style.display="none";
document.getElementById("startScreen").style.display="flex";
state="start";
}

function spawn(){
let rand=Math.random();
let item={x:Math.random()*360,y:-30,speed:speed};
if(rand<0.15){item.type="üëÆ";item.danger=true;item.val=0;}
else if(rand<0.5){item.type="ü¶¥";item.val=1;}
else if(rand<0.8){item.type="üç™";item.val=2;}
else{item.type="üçó";item.val=3;}
if(!item.danger) totalPoints+=item.val;
items.push(item);
}

function drawBackground(){
ctx.fillStyle="#6cc24a";
ctx.fillRect(0,580,400,70);
ctx.fillStyle="#444";
ctx.fillRect(0,600,400,50);
ctx.fillStyle="white";
clouds.forEach(c=>{
ctx.beginPath();
ctx.arc(c.x,c.y,20,0,Math.PI*2);
ctx.arc(c.x+20,c.y,25,0,Math.PI*2);
ctx.arc(c.x+40,c.y,20,0,Math.PI*2);
ctx.fill();
});
}

function loop(){
if(state!=="play")return;
ctx.clearRect(0,0,400,650);
drawBackground();

clouds.forEach(c=>{c.x+=0.2;if(c.x>450)c.x=-50;});
if(Math.random()<0.04)spawn();

items.forEach((item,i)=>{
item.y+=item.speed;
ctx.font="35px Arial";
ctx.fillText(item.type,item.x,item.y);

if(item.y>500 && item.y<550 && item.x>dog.x-20 && item.x<dog.x+40){
if(item.danger){
lives--;
playPostmanSound();
if(lives<=0)return endGame();
}else{
score+=item.val;
collectedPoints+=item.val;
playCollectSound();
}
items.splice(i,1);
}
});

ctx.font="40px Arial";
ctx.fillText("üê∂",dog.x,520);

ctx.fillStyle="black";
ctx.fillText("Score: "+score,10,30);
ctx.fillText("‚ù§Ô∏è "+lives,300,30);
ctx.fillText("Level "+level,160,30);

timeLeft-=1/60;
ctx.fillText("‚è± "+Math.ceil(timeLeft),170,60);

if(timeLeft<=0){
let percent= collectedPoints/totalPoints;
if(percent<0.8){
lives--;
playLifeLostSound();
if(lives<=0)return endGame();
}
nextLevel();
}

requestAnimationFrame(loop);
}

function nextLevel(){
level++;
speed+=0.5;
timeLeft=30;
items=[];
totalPoints=0;
collectedPoints=0;
}

function endGame(){
state="over";
document.getElementById("finalScore").innerText="Score: "+score;
document.getElementById("gameOver").style.display="flex";
}

/* Leise Sounds */
function playCollectSound(){
const a=new AudioContext();
const o=a.createOscillator();
const g=a.createGain();
g.gain.value=0.05;
o.frequency.value=500;
o.connect(g);g.connect(a.destination);
o.start();o.stop(a.currentTime+0.1);
}

function playPostmanSound(){
const a=new AudioContext();
const o=a.createOscillator();
const g=a.createGain();
g.gain.value=0.08;
o.frequency.value=150;
o.connect(g);g.connect(a.destination);
o.start();o.stop(a.currentTime+0.3);
}

function playLifeLostSound(){
const a=new AudioContext();
const o=a.createOscillator();
const g=a.createGain();
g.gain.value=0.07;
o.frequency.value=90;
o.connect(g);g.connect(a.destination);
o.start();o.stop(a.currentTime+0.4);
}
</script>

</body>
</html>
