<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doggyco - Bitcoin Arcade</title>
    <style>
        :root { 
            --btc-orange: #f7931a; 
            --arcade-blue: #1a1a2e; 
            --neon-gold: #ffcc00;
        }
        body { 
            background-color: #0a0a0a; 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            overflow: hidden; 
            touch-action: none; 
        }
        
        header { 
            width: 100%; 
            padding: 20px 0; 
            text-align: center; 
            background: linear-gradient(to bottom, #1a1a1a, #000); 
            border-bottom: 3px solid var(--btc-orange);
            box-shadow: 0 4px 15px rgba(247, 147, 26, 0.3);
        }

        .logo { 
            width: 100px; 
            height: 100px; 
            border-radius: 50%; 
            border: 3px solid var(--btc-orange);
            margin-bottom: 10px;
            box-shadow: 0 0 20px var(--btc-orange);
        }

        h1 { 
            margin: 0; 
            letter-spacing: 4px; 
            font-size: 28px; 
            color: var(--btc-orange); 
            text-shadow: 2px 2px #000;
        }

        #game-container { 
            position: relative; 
            width: 95vw; 
            max-width: 450px; 
            margin-top: 15px; 
        }

        .stats-bar { 
            display: flex; 
            justify-content: space-between; 
            padding: 12px; 
            background: #111; 
            border: 2px solid var(--btc-orange); 
            border-bottom: none;
            font-family: 'Courier New', Courier, monospace; 
            font-size: 16px;
            color: var(--neon-gold);
        }

        canvas { 
            width: 100%; 
            background: radial-gradient(circle, #1a1a2e 0%, #050505 100%);
            border: 2px solid var(--btc-orange); 
            display: block; 
        }

        #timer-bar { width: 100%; height: 8px; background: #333; }
        #timer-fill { width: 100%; height: 100%; background: #27ae60; transition: width 0.1s linear; }

        /* Start-Men√º & Regeln */
        #pay-modal { 
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 20; 
            text-align: center; 
            padding: 20px;
            box-sizing: border-box;
        }

        .rules-box {
            text-align: left;
            background: #222;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #444;
            font-size: 13px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .rules-box b { color: var(--btc-orange); }

        .btn { 
            background: var(--btc-orange); 
            color: black; 
            border: none; 
            padding: 18px; 
            border-radius: 10px; 
            font-weight: bold; 
            width: 90%; 
            cursor: pointer; 
            font-size: 18px;
            box-shadow: 0 4px 0 #b36b00;
        }
        .btn:active { transform: translateY(3px); box-shadow: none; }
    </style>
</head>
<body>

<header>
    <img src="doggyco.png" alt="Doggyco Logo" class="logo">
    <h1>DOGGYCO ARCADE</h1>
</header>

<div id="game-container">
    <div class="stats-bar">
        <div>SCORE: <span id="score">0</span></div>
        <div>LVL: <span id="level">1</span></div>
        <div>‚ù§Ô∏è: <span id="lives">3</span></div>
    </div>
    <div id="timer-bar"><div id="timer-fill"></div></div>
    
    <canvas id="gameCanvas" width="400" height="500"></canvas>

    <div id="pay-modal">
        <h2 style="color:var(--btc-orange); margin-bottom:10px;">SPIELREGELN</h2>
        <div class="rules-box">
            ‚Ä¢ ü¶¥ <b>Knochen:</b> 1 Punkt<br>
            ‚Ä¢ üçñ <b>Fleisch:</b> 2 Punkte<br>
            ‚Ä¢ üçó <b>Keule:</b> 3 Punkte<br><br>
            ‚Ä¢ <b>Ziel:</b> Sammle <b>90% aller Punkte</b> pro Level!<br>
            ‚Ä¢ <b>Zeit:</b> Du hast 30 Sekunden pro Level.<br>
            ‚Ä¢ <b>Fail:</b> Wer die Quote verfehlt, verliert ein ‚ù§Ô∏è.
        </div>
        <button class="btn" onclick="initGame(3)">JETZT SPIELEN (10 SATs)</button>
        <p style="font-size:10px; color:#666; margin-top:15px;">Zahle via Lightning Network</p>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    let score = 0, lives = 3, level = 1, active = false;
    let items = [], totalSpawnedPoints = 0, collectedPoints = 0;
    let timeLeft = 30;
    let dog = { x: 175, y: 420, size: 60, tilt: 0, blink: 0 };
    let audioCtx = null;

    function initAudio() { 
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); 
    }

    // Sound-Funktion
    function playSound(freq, duration, type="sine") {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    // Hunde-Bellen-Effekt
    function bark() {
        playSound(400, 0.1, "square");
        setTimeout(() => playSound(300, 0.15, "square"), 100);
    }

    function move(clientX) {
        const rect = canvas.getBoundingClientRect();
        dog.x = (clientX - rect.left) * (canvas.width / rect.width) - (dog.size / 2);
        if (dog.x < 0) dog.x = 0;
        if (dog.x > canvas.width - dog.size) dog.x = canvas.width - dog.size;
    }

    canvas.addEventListener('touchmove', (e) => { initAudio(); move(e.touches[0].clientX); e.preventDefault(); }, {passive: false});
    canvas.addEventListener('mousemove', (e) => { initAudio(); move(e.clientX); });

    function initGame(l) {
        initAudio();
        lives = l; score = 0; level = 1; active = true;
        document.getElementById('pay-modal').style.display = 'none';
        bark();
        startLevel();
        gameLoop();
    }

    function startLevel() {
        items = [];
        totalSpawnedPoints = 0;
        collectedPoints = 0;
        timeLeft = 30;
        spawnItem();
    }

    function spawnItem() {
        if (!active || timeLeft <= 0) return;
        const rand = Math.random();
        let item = { x: Math.random() * 360, y: -30, speed: 2.5 + (level * 0.5) };
        
        if (rand < 0.6) { item.type = "ü¶¥"; item.val = 1; }
        else if (rand < 0.9) { item.type = "üçñ"; item.val = 2; }
        else { item.type = "üçó"; item.val = 3; }
        
        items.push(item);
        totalSpawnedPoints += item.val;
        
        let nextSpawn = 1000 - Math.min(level * 60, 700);
        setTimeout(spawnItem, nextSpawn);
    }

    function gameLoop() {
        if (!active) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Zeit-Management
        timeLeft -= 1/60;
        document.getElementById('timer-fill').style.width = (timeLeft / 30 * 100) + "%";
        if (timeLeft < 10) document.getElementById('timer-fill').style.backgroundColor = "red";
        else document.getElementById('timer-fill').style.backgroundColor = "#27ae60";

        if (timeLeft <= 0) {
            checkLevelPass();
            return;
        }

        // Hund Zeichnen
        ctx.save();
        if (dog.blink > 0) { 
            ctx.fillStyle = "rgba(255, 0, 0, 0.3)"; 
            ctx.fillRect(0,0,canvas.width,canvas.height); 
            dog.blink--; 
        }
        ctx.translate(dog.x + 30, dog.y + 30);
        if (dog.tilt > 0) { ctx.rotate(0.15); dog.tilt--; }
        ctx.font = "50px Arial";
        ctx.textAlign = "center";
        ctx.fillText("üê∂", 0, 15);
        ctx.restore();

        // Items bewegen
        for (let i = items.length - 1; i >= 0; i--) {
            items[i].y += items[i].speed;
            ctx.font = "35px Arial";
            ctx.fillText(items[i].type, items[i].x + 20, items[i].y);

            // Kollisionsabfrage
            if (items[i].y > dog.y && items[i].y < dog.y + 60 && 
                items[i].x > dog.x - 25 && items[i].x < dog.x + 55) {
                
                score += items[i].val;
                collectedPoints += items[i].val;
                dog.tilt = 8;
                playSound(600 + (items[i].val * 100), 0.1);
                items.splice(i, 1);
                document.getElementById('score').innerText = score;
            } else if (items[i].y > 510) {
                items.splice(i, 1);
            }
        }

        document.getElementById('lives').innerText = lives;
        document.getElementById('level').innerText = level;
        requestAnimationFrame(gameLoop);
    }

    function checkLevelPass() {
        const quota = totalSpawnedPoints > 0 ? collectedPoints / totalSpawnedPoints : 1;
        
        if (quota >= 0.9) {
            level++;
            bark();
            alert("SUPER! Level geschafft. \nQuote: " + Math.round(quota*100) + "%");
            startLevel();
            gameLoop();
        } else {
            lives--;
            dog.blink = 30;
            playSound(150, 0.5, "sawtooth");
            
            if (lives <= 0) {
                active = false;
                document.getElementById('pay-modal').style.display = 'flex';
                document.getElementById('msg').innerText = "GAME OVER!";
            } else {
                alert("LEBEN VERLOREN! \nNur " + Math.round(quota*100) + "% gefangen. \n(90% sind Pflicht!)");
                startLevel();
                gameLoop();
            }
        }
    }
</script>
</body>
</html>
