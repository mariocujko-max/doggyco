<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Doggyco 3.2</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #2c3e50;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #gameWrapper {
            position: relative;
            width: 400px;
            height: 650px;
            overflow: hidden;
            border-radius: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            background: #87CEEB;
        }

        #uiPanel {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            color: #333;
            z-index: 10;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        canvas { display: block; background: linear-gradient(#87CEEB, #e0f6ff); }

        #controlBar {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 80px;
            background: #1c1c1c;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #slider {
            width: 85%;
            appearance: none;
            height: 15px;
            border-radius: 10px;
            background: #444;
            outline: none;
        }

        #slider::-webkit-slider-thumb {
            appearance: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: #ffd166;
            border: 4px solid #fff;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
            padding: 20px;
            z-index: 20;
        }

        input {
            padding: 12px;
            border-radius: 10px;
            border: none;
            margin-bottom: 10px;
            width: 200px;
            text-align: center;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff9ecf, #ffd166);
            font-weight: bold;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        button:hover { transform: scale(1.05); }
    </style>
</head>
<body>

<div id="gameWrapper">
    <div id="uiPanel">
        <div>‚≠ê <span id="score">0</span></div>
        <div>‚ù§Ô∏è <span id="lives">3</span></div>
        <div>‚è± <span id="time">30</span></div>
    </div>

    <canvas id="game" width="400" height="650"></canvas>

    <div id="controlBar">
        <input type="range" id="slider" min="20" max="340" value="180">
    </div>

    <div class="overlay" id="startScreen">
        <h1 style="margin-bottom: 10px;">üê∂ Doggyco 3.2</h1>
        <p style="margin-bottom: 20px;">Sammle Leckerlis, weiche der Polizei aus!</p>
        <input type="text" id="playerName" placeholder="Dein Name" maxlength="12">
        <button onclick="startGame()">Starten</button>
    </div>

    <div class="overlay" id="gameOver" style="display:none;">
        <h2>Game Over!</h2>
        <p id="finalScore" style="font-size: 2em; margin: 15px 0;"></p>
        <button onclick="restart()">Nochmal versuchen</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    const slider = document.getElementById("slider");
    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const timeEl = document.getElementById("time");
    const playerNameInput = document.getElementById("playerName");

    let state = "start";
    let score, lives, timeLeft, items, dog, spawnTimer;
    let audioCtx;

    // Initialisierung des AudioContext nach User-Interaktion
    function initAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    function init() {
        score = 0;
        lives = 3;
        timeLeft = 30;
        items = [];
        spawnTimer = 0;
        dog = { x: 180, y: 530, w: 50, h: 50 };
        slider.value = 180;
    }

    slider.addEventListener("input", e => {
        dog.x = parseInt(e.target.value);
    });

    function startGame() {
        if (!playerNameInput.value.trim()) {
            alert("Wie hei√üt dein Hund? üê∂");
            return;
        }
        initAudio();
        init();
        state = "play";
        document.getElementById("startScreen").style.display = "none";
        loop();
    }

    function restart() {
        document.getElementById("gameOver").style.display = "none";
        document.getElementById("startScreen").style.display = "flex";
        state = "start";
    }

    function spawn() {
        let rand = Math.random();
        let item = {
            x: 30 + Math.random() * 320,
            y: -50,
            speed: 3 + (score * 0.1), // Wird mit der Zeit schneller
            type: "",
            danger: false,
            val: 0
        };

        if (rand < 0.25) {
            item.type = "üëÆ";
            item.danger = true;
            item.blink = 0;
        } else {
            const types = [
                {t: "ü¶¥", v: 1},
                {t: "üç™", v: 2},
                {t: "üçó", v: 5}
            ];
            let pick = types[Math.floor(Math.random() * types.length)];
            item.type = pick.t;
            item.val = pick.v;
        }
        items.push(item);
    }

    function loop() {
        if (state !== "play") return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawBackground();

        // Spawn-Logik
        spawnTimer++;
        if (spawnTimer > 60) {
            spawn();
            spawnTimer = 0;
        }

        // Items verarbeiten
        for (let i = items.length - 1; i >= 0; i--) {
            let it = items[i];
            it.y += it.speed;

            // Zeichnen
            ctx.save();
            if (it.danger) {
                it.blink += 0.1;
                ctx.shadowBlur = 10;
                ctx.shadowColor = "red";
                ctx.globalAlpha = 0.5 + Math.abs(Math.sin(it.blink)) * 0.5;
            }
            ctx.font = "40px Arial";
            ctx.fillText(it.type, it.x - 20, it.y);
            ctx.restore();

            // Kollision (Besseres Hit-Box System)
            if (it.y > dog.y - 20 && it.y < dog.y + 40 && it.x > dog.x - 30 && it.x < dog.x + 50) {
                if (it.danger) {
                    lives--;
                    playPostmanSound();
                    if (lives <= 0) return endGame();
                } else {
                    score += it.val;
                    playCollectSound();
                }
                items.splice(i, 1);
                continue;
            }

            // Aus dem Bild entfernen
            if (it.y > 600) items.splice(i, 1);
        }

        // Hund zeichnen
        ctx.font = "50px Arial";
        ctx.fillText("üê∂", dog.x - 25, dog.y + 20);

        // Zeit-Logik
        timeLeft -= 1/60;
        if (timeLeft <= 0) return endGame();

        updateUI();
        requestAnimationFrame(loop);
    }

    function drawBackground() {
        // Gras
        ctx.fillStyle = "#6cc24a";
        ctx.fillRect(0, 550, 400, 100);
        // Stra√üe
        ctx.fillStyle = "#555";
        ctx.fillRect(0, 600, 400, 50);
        // Mittelstreifen
        ctx.strokeStyle = "white";
        ctx.setLineDash([20, 20]);
        ctx.beginPath(); ctx.moveTo(0, 625); ctx.lineTo(400, 625); ctx.stroke();
        ctx.setLineDash([]);
    }

    function updateUI() {
        scoreEl.innerText = score;
        livesEl.innerText = lives;
        timeEl.innerText = Math.ceil(timeLeft);
    }

    function playCollectSound() {
        if(!audioCtx) return;
        let o = audioCtx.createOscillator();
        let g = audioCtx.createGain();
        o.type = "sine";
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
        o.frequency.setValueAtTime(600, audioCtx.currentTime);
        o.frequency.exponentialRampToValueAtTime(900, audioCtx.currentTime + 0.1);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + 0.1);
    }

    function playPostmanSound() {
        if(!audioCtx) return;
        let o = audioCtx.createOscillator();
        let g = audioCtx.createGain();
        o.type = "sawtooth";
        g.gain.setValueAtTime(0.1, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
        o.frequency.setValueAtTime(150, audioCtx.currentTime);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + 0.3);
    }

    function endGame() {
        state = "over";
        document.getElementById("finalScore").innerText = "Punkte: " + score;
        document.getElementById("gameOver").style.display = "flex";
    }
</script>

</body>
</html>

