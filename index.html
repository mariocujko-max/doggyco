<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Doggyco - Bitcoin Arcade</title>
    <style>
        :root { 
            --btc-orange: #f7931a; 
            --arcade-blue: #1a1a2e; 
            --neon-gold: #ffcc00;
            --danger: #ff4444;
        }
        body { 
            background-color: #0a0a0a; 
            color: white; 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            overflow: hidden; 
            touch-action: none; 
        }
        
        header { 
            width: 100%; 
            padding: 15px 0; 
            text-align: center; 
            background: #111; 
            border-bottom: 3px solid var(--btc-orange);
        }

        .logo { width: 70px; height: 70px; border-radius: 50%; border: 2px solid var(--btc-orange); }

        #game-container { 
            position: relative; 
            width: 95vw; 
            max-width: 450px; 
            margin-top: 10px; 
        }

        .stats-bar { 
            display: flex; 
            justify-content: space-between; 
            padding: 12px; 
            background: #111; 
            border: 2px solid var(--btc-orange); 
            border-bottom: none;
            font-family: monospace; 
            font-size: 18px;
        }

        #lives-box.hit {
            animation: shake 0.5s;
            color: var(--danger);
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            100% { transform: translateX(0); }
        }

        canvas { 
            width: 100%; 
            background: radial-gradient(circle, #1a1a2e 0%, #050505 100%);
            border: 2px solid var(--btc-orange); 
            display: block; 
        }

        #timer-bar { width: 100%; height: 6px; background: #333; }
        #timer-fill { width: 100%; height: 100%; background: #27ae60; transition: width 0.1s linear; }

        #pay-modal { 
            position: absolute; 
            top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.95); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            z-index: 20; 
            text-align: center; 
            padding: 20px;
            box-sizing: border-box;
        }

        .btn { 
            background: var(--btc-orange); 
            color: black; 
            border: none; 
            padding: 18px; 
            border-radius: 10px; 
            font-weight: bold; 
            width: 90%; 
            cursor: pointer; 
            font-size: 18px;
        }
    </style>
</head>
<body>

<header>
    <img src="doggyco.png" alt="Logo" class="logo">
    <h1 style="margin:0; font-size: 22px; color: var(--btc-orange);">DOGGYCO</h1>
</header>

<div id="game-container">
    <div class="stats-bar">
        <div>SCORE: <span id="score">0</span></div>
        <div id="lives-box">‚ù§Ô∏è: <span id="lives">3</span></div>
    </div>
    <div id="timer-bar"><div id="timer-fill"></div></div>
    
    <canvas id="gameCanvas" width="400" height="500"></canvas>

    <div id="pay-modal">
        <h2 style="color:var(--btc-orange)">SPIELREGELN</h2>
        <p style="font-size:14px;">
            Sammle <b>70%</b> der Punkte!<br>
            Achtung vor dem Postboten üëÆ!<br>
            Bewahre deine 3 Leben.
        </p>
        <button class="btn" onclick="initGame(3)">START (10 SATs)</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    
    let score = 0, lives = 3, level = 1, active = false;
    let items = [], totalSpawnedPoints = 0, collectedPoints = 0;
    let timeLeft = 30;
    let dog = { x: 175, y: 400, size: 60, tilt: 0, targetTilt: 0 };
    let audioCtx = null;

    function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

    function move(clientX) {
        const rect = canvas.getBoundingClientRect();
        dog.x = (clientX - rect.left) * (400 / rect.width) - 30;
        dog.x = Math.max(0, Math.min(340, dog.x));
    }

    canvas.addEventListener('touchmove', (e) => { initAudio(); move(e.touches[0].clientX); e.preventDefault(); }, {passive: false});
    canvas.addEventListener('mousemove', (e) => { initAudio(); move(e.clientX); });

    function initGame(l) {
        initAudio();
        lives = l; score = 0; level = 1; active = true;
        document.getElementById('pay-modal').style.display = 'none';
        startLevel();
        gameLoop();
    }

    function startLevel() {
        items = []; totalSpawnedPoints = 0; collectedPoints = 0; timeLeft = 30;
        spawnItem();
    }

    function spawnItem() {
        if (!active || timeLeft <= 0) return;
        const rand = Math.random();
        let item = { x: Math.random() * 350, y: -40, speed: 2.5 + (level * 0.4) };
        
        if (rand < 0.1) { item.type = "üëÆ"; item.val = 0; item.danger = true; } // Postbote
        else if (rand < 0.6) { item.type = "ü¶¥"; item.val = 1; }
        else if (rand < 0.85) { item.type = "üçñ"; item.val = 2; }
        else { item.type = "üçó"; item.val = 3; }
        
        items.push(item);
        if (!item.danger) totalSpawnedPoints += item.val;
        setTimeout(spawnItem, 1000 - Math.min(level * 50, 700));
    }

    function loseLife(reason) {
        lives--;
        const box = document.getElementById('lives-box');
        box.classList.add('hit');
        setTimeout(() => box.classList.remove('hit'), 500);
        
        if (lives <= 0) {
            active = false;
            document.getElementById('pay-modal').style.display = 'flex';
            document.getElementById('pay-modal').querySelector('h2').innerText = "GAME OVER";
        }
    }

    function gameLoop() {
        if (!active) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        timeLeft -= 1/60;
        document.getElementById('timer-fill').style.width = (timeLeft / 30 * 100) + "%";

        if (timeLeft <= 0) {
            const quota = collectedPoints / totalSpawnedPoints;
            if (quota >= 0.7) { level++; startLevel(); } 
            else { loseLife(); if(active) startLevel(); }
        }

        // Hund & Navigations-Punkt
        ctx.save();
        ctx.translate(dog.x + 30, dog.y + 30);
        
        // Weiches Nicken
        dog.tilt += (dog.targetTilt - dog.tilt) * 0.1;
        ctx.rotate(dog.tilt);
        if (dog.targetTilt !== 0 && Math.abs(dog.tilt - dog.targetTilt) < 0.01) dog.targetTilt = 0;

        ctx.font = "55px Arial";
        ctx.textAlign = "center";
        ctx.fillText("üê∂", 0, 15);
        
        // Navigations-Punkt unter dem Hund
        ctx.restore();
        ctx.fillStyle = "var(--btc-orange)";
        ctx.beginPath();
        ctx.arc(dog.x + 30, dog.y + 80, 5, 0, Math.PI * 2);
        ctx.fill();

        // Items
        for (let i = items.length - 1; i >= 0; i--) {
            items[i].y += items[i].speed;
            ctx.font = "40px Arial";
            ctx.fillText(items[i].type, items[i].x, items[i].y);

            if (items[i].y > dog.y && items[i].y < dog.y + 60 && items[i].x > dog.x - 20 && items[i].x < dog.x + 50) {
                if (items[i].danger) {
                    loseLife();
                } else {
                    score += items[i].val;
                    collectedPoints += items[i].val;
                    dog.targetTilt = 0.3; // Startet Nicken
                }
                items.splice(i, 1);
            } else if (items[i].y > 550) {
                items.splice(i, 1);
            }
        }

        document.getElementById('score').innerText = score;
        document.getElementById('lives').innerText = lives;
        if(active) requestAnimationFrame(gameLoop);
    }
</script>
</body>
</html>
