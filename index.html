<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Doggyco: Evolved V32 - Leaderboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --gold: #ffd700; --red: #ff3131; --glass: rgba(0, 15, 30, 0.9); }
        * { margin:0; padding:0; box-sizing:border-box; touch-action:none; }
        body { background:#0a0a0a; color: white; font-family: 'Orbitron', sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; padding: 20px 0; overflow-x: hidden; }
        
        #game-container { position:relative; height:80vh; width:100%; max-width:500px; overflow:hidden; border: 4px solid #333; background-image: url('hintergrund.png'); background-size: cover; background-position: center; border-radius: 10px; }

        /* HUD OBEN */
        #hud { position: absolute; top: 0; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 15px; background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent); z-index: 60; }
        .hud-item { min-width: 80px; text-align: center; }
        #timer-ui { color: var(--neon); font-size: 20px; font-weight: 900; }
        #score-ui { font-size: 24px; font-weight: 900; color: var(--gold); }
        #hearts-ui { font-size: 18px; letter-spacing: 2px; }

        canvas { width: 100%; height: 100%; display: block; }

        /* RANGLISTE & ANLEITUNG */
        #ui-bottom { width: 100%; max-width: 500px; margin-top: 20px; padding: 0 15px; }
        .panel { background: var(--glass); border: 1px solid #444; border-radius: 10px; padding: 15px; margin-bottom: 15px; }
        h3 { color: var(--neon); margin-bottom: 10px; font-size: 14px; text-transform: uppercase; border-bottom: 1px solid #333; padding-bottom: 5px; }
        
        #leaderboard-list { list-style: none; font-size: 14px; }
        #leaderboard-list li { display: flex; justify-content: space-between; padding: 4px 0; border-bottom: 1px border-bottom: 1px solid rgba(255,255,255,0.05); }
        .gold { color: var(--gold); }

        .guide-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 12px; }
        .guide-item { display: flex; align-items: center; gap: 8px; }

        /* OVERLAYS */
        .overlay { position:absolute; inset:0; background:rgba(0,0,0,0.9); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:100; text-align: center; padding: 20px; }
        input { background: #111; border: 2px solid var(--neon); color: white; padding: 10px; font-family: 'Orbitron'; margin-bottom: 20px; text-align: center; width: 80%; }
        .btn { padding: 15px 40px; font-size: 18px; background: transparent; color: var(--neon); border: 2px solid var(--neon); cursor: pointer; font-weight: 900; transition: 0.3s; }
        .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 20px var(--neon); }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="hud">
            <div id="hearts-ui" class="hud-item">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
            <div id="score-ui" class="hud-item">0</div>
            <div id="timer-ui" class="hud-item">30s</div>
        </div>
        <canvas id="game"></canvas>

        <div class="overlay" id="startScreen">
            <h1 style="color:var(--neon); margin-bottom:20px;">DOGGYCO HD</h1>
            <p style="font-size: 12px; margin-bottom: 10px;">GIB DEINEN NAMEN EIN:</p>
            <input type="text" id="playerName" maxlength="10" placeholder="SPIELER">
            <button class="btn" onclick="startGame()">START</button>
        </div>

        <div class="overlay" style="display:none;" id="gameOver">
            <h2 style="color:var(--red);">GAME OVER</h2>
            <h1 id="final-score" style="font-size:50px; margin:10px 0;">0</h1>
            <button class="btn" onclick="location.reload()">NEUSTART</button>
        </div>
    </div>

    <div id="ui-bottom">
        <div class="panel">
            <h3>üèÜ RANGLISTE</h3>
            <ul id="leaderboard-list">
                </ul>
        </div>

        <div class="panel">
            <h3>üìñ ANLEITUNG</h3>
            <div class="guide-grid">
                <div class="guide-item"><span>ü¶¥</span> 1 Pkt</div>
                <div class="guide-item"><span>üç™</span> 2 Pkt</div>
                <div class="guide-item"><span>üçó</span> 3 Pkt</div>
                <div class="guide-item"><span>‚ù§Ô∏è</span> +1 Leben / 10 Pkt</div>
                <div class="guide-item" style="color:var(--red)"><span>üëÆ</span> -1 Leben!</div>
                <div class="guide-item"><span>üï∑Ô∏è</span> -Zeit</div>
            </div>
            <p style="font-size:10px; margin-top:10px; color:#888;">BEWEGE DEN HUND MIT DER MAUS ODER DEM FINGER.</p>
        </div>
    </div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W, H, lanes = 5, laneW;
let dogX = 0, targetX = 0, dogLane = 2;
let items = [], spiders = [], floaters = [];
let score = 0, hearts = 3, timeLeft = 30, level = 1, active = false, currentPlayer = "Spieler";
let audioCtx;

// SOUNDS
function playSFX(f, type, d, v=0.1) {
    if (!audioCtx) return;
    let o = audioCtx.createOscillator(), g = audioCtx.createGain();
    o.type = type; o.frequency.setValueAtTime(f, audioCtx.currentTime);
    g.gain.setValueAtTime(v, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + d);
}

function resize() {
    W = canvas.width = canvas.parentElement.offsetWidth;
    H = canvas.height = canvas.parentElement.offsetHeight;
    laneW = W / lanes;
    dogX = W / 2;
}
window.onresize = resize; resize();

// VERBESSERTE STEUERUNG (Maus & Touch folgt direkt)
const updateInput = (e) => {
    let clientX = e.touches ? e.touches[0].clientX : e.clientX;
    let rect = canvas.getBoundingClientRect();
    let x = clientX - rect.left;
    dogLane = Math.max(0, Math.min(lanes - 1, Math.floor(x / laneW)));
};
canvas.addEventListener('mousemove', updateInput);
canvas.addEventListener('touchmove', (e) => { e.preventDefault(); updateInput(e); }, {passive:false});

function startGame() {
    let nameInput = document.getElementById("playerName").value;
    if(nameInput) currentPlayer = nameInput;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    document.getElementById("startScreen").style.display = "none";
    active = true;
    
    // Initial Spiders
    for(let i=0; i<2; i++) spiders.push({x: Math.random()*W, t: Math.random()*Math.PI, speed: 0.02});
    
    updateLeaderboard();
    requestAnimationFrame(loop);
}

function updateLeaderboard() {
    let scores = JSON.parse(localStorage.getItem('doggyScores') || '[]');
    let list = document.getElementById("leaderboard-list");
    list.innerHTML = scores.map((s, i) => `<li><span class="${i==0?'gold':''}">#${i+1} ${s.name}</span><span>${s.score}</span></li>`).join('');
}

function saveScore(name, finalScore) {
    let scores = JSON.parse(localStorage.getItem('doggyScores') || '[]');
    scores.push({name: name, score: finalScore});
    scores.sort((a,b) => b.score - a.score);
    localStorage.setItem('doggyScores', JSON.stringify(scores.slice(0, 5)));
}

let lastTime = performance.now();
function loop(t) {
    if(!active) return;
    let delta = (t - lastTime) / 1000;
    lastTime = t;
    ctx.clearRect(0,0,W,H);

    // TIMER LOGIK
    timeLeft -= delta;
    document.getElementById("timer-ui").innerText = Math.ceil(timeLeft) + "s";
    
    if(timeLeft <= 0) {
        level++;
        timeLeft = 30;
        playSFX(880, 'sine', 0.5, 0.1);
    }

    // ITEM SPAWNING
    if(Math.random() < 0.02 + (level*0.005)) {
        let types = ['ü¶¥', 'üç™', 'üçó', '‚ù§Ô∏è', 'üëÆ'];
        let r = Math.random();
        let type = r < 0.4 ? 'ü¶¥' : (r < 0.65 ? 'üç™' : (r < 0.8 ? 'üçó' : (r < 0.9 ? '‚ù§Ô∏è' : 'üëÆ')));
        items.push({lane: Math.floor(Math.random()*lanes), y: -50, type: type});
    }

    for(let i=items.length-1; i>=0; i--) {
        let it = items[i];
        it.y += (4 + level * 0.8);
        let ix = it.lane*laneW + laneW/2;
        
        ctx.font = "40px Arial"; ctx.textAlign = "center";
        ctx.fillText(it.type, ix, it.y);

        // KOLLISION
        if(it.lane === dogLane && it.y > H-130 && it.y < H-70) {
            if(it.type === 'üëÆ') {
                hearts--; playSFX(100, 'sawtooth', 0.4, 0.2);
            } else if(it.type === '‚ù§Ô∏è') {
                if(hearts < 3) hearts++; else score += 10 * level;
                playSFX(600, 'sine', 0.3);
            } else {
                let pts = it.type === 'ü¶¥' ? 1 : (it.type === 'üç™' ? 2 : 3);
                let gain = pts * level;
                score += gain;
                playSFX(400 + (pts*100), 'sine', 0.1);
                floaters.push({x: ix, y: it.y, txt: "+" + gain, life: 1.0});
            }
            items.splice(i, 1);
        } else if(it.y > H) items.splice(i, 1);
    }

    // SPIDER LOGIK
    spiders.forEach(s => {
        s.t += s.speed + (level * 0.002);
        let sy = (Math.sin(s.t) + 1) / 2 * (H - 200);
        if(sy < 5 && Math.abs(Math.sin(s.t)) > 0.98) s.x = Math.random() * W;

        ctx.strokeStyle = "rgba(255,255,255,0.3)"; ctx.beginPath();
        ctx.moveTo(s.x, 0); ctx.lineTo(s.x, sy); ctx.stroke();
        ctx.font = "35px Arial"; ctx.fillText("üï∑Ô∏è", s.x, sy + 25);

        if(Math.abs(s.x - dogX) < 40 && sy > H-150 && sy < H-70) timeLeft -= 0.1;
    });

    // FLOATING TEXT
    for(let i=floaters.length-1; i>=0; i--) {
        let f = floaters[i]; f.y -= 2; f.life -= 0.02;
        ctx.fillStyle = `rgba(255, 215, 0, ${f.life})`;
        ctx.font = "bold 20px Orbitron"; ctx.fillText(f.txt, f.x, f.y);
        if(f.life <= 0) floaters.splice(i, 1);
    }

    // DOG BEWEGUNG
    targetX = dogLane * laneW + laneW/2;
    dogX += (targetX - dogX) * 0.25;
    ctx.font = "55px Arial"; ctx.fillText("üê∂", dogX, H - 80);

    // UI UPDATE
    document.getElementById("score-ui").innerText = score;
    document.getElementById("hearts-ui").innerText = "‚ù§Ô∏è".repeat(Math.max(0, hearts));

    if(hearts <= 0) {
        active = false;
        saveScore(currentPlayer, score);
        document.getElementById("gameOver").style.display = "flex";
        document.getElementById("final-score").innerText = score;
    } else {
        requestAnimationFrame(loop);
    }
}
</script>
</body>
</html>

